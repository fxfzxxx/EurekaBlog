---
title: 通俗讲解 git 的使用方法
description: 包括工作中的版本控制, 解决冲突以及 github 的使用.
toc: true
authors:
  - Aaron
tags:
  - All
categories:
  - Technology
series:
  - git以及Github
date: '2021-12-06'
lastmod: '2021-12-06'
featuredImage: images/git.webp
draft: false
---

# git 分布式版本管理器

## git

- 安装在电脑里的一个软件
- 用来管理文件夹(repo)
  - 管理: 管理文件夹内时间节点
- 把文件夹内的代码上传到指定的远程位置
- 没有可视化操作, 一切都在命令行中操作

## Github

- 线上网站
- 保存 git 上传的代码
- 其它软件无法上传
- 社交平台, 开源, 讨论

## 首次安装 git 配置

- 第一次安装 git 需要配置全局内容
- 为了将来上传的时候的签名
- 查看全局配置
  - 打开命令行, 目录无所谓
  - 输入指令`$ config --list`
- 配置全局邮箱
  - 打开命令行, 目录无所谓
  - 输入指令 `$ config --global user.email "@"`
  - 随便写也行, 就是一个签名, 最好是 Github 注册的邮箱
- 配置全局用户名
  - 打开命令行, 目录无所谓
  - 输入指令 `$ config --global user.name ""`
  - 随便写也行, 就是一个签名, 最好是 Github 注册的用户名

## 首次使用 git

### 1. 本地仓库初始化

- 需要把一个文件夹初始化成一个 git 仓库 repo

  - 这个文件夹的及文件夹的所有后代才会被 git 管理

- 打开命令行

  - 切换到 git 需要管理的文件夹内
  - 输入指令 `$git init`
  - 如果成功, 文件夹内会多一个 .git 的文件夹
  - 就表示 .git 所在的文件夹及所有后代的目录都被 git 管理了
  - 这个文件夹就叫做一个 本地仓库

- 初始化后

  - 当一个目录被初始化为一个 git 仓库后
  - 文件夹会被虚拟的分为三个部分
    1. **工作区**
       - 书写代码的真是位置
    2. **暂存区**
       - 暂时存储一些内容, 存储的不是文件而是节点
       - 把想要形成历史版本的节点, 暂时存储一下
    3. **历史区**
       - 已经形成历史的版本, 将来可以穿越回来的历史节点
       - 历史区只能把 暂存区 里面的节点 变为历史节点
       - 不能直接操作工作区
  - 上传的时候
    - git 只能上传 历史区 的内容
    - 不能上传 工作区 和 暂存区 的内容
    - 如果历史区没有内容, 会提示你上传不成功

  <img src="C:\Users\Aaron\AppData\Roaming\Typora\typora-user-images\image-20210712173555982.png" alt="image-20210712173555982" style="zoom: 67%;" />

### 2. 把工作内容添加到暂存区

- 工作区需要有内容 (`.git` 不算)
  - 空文件可以添加, 空文件夹不行
  - 没有形成历史版本的暂存区会被覆盖
- 打开命令行
  - `$git add 文件名`
  - `$git add 文件夹名`
  - `$git add --all` : 添加当前工作区所有内容
    - 简写: `$git add .`

### 3. 查看工作区和暂存区的状态

- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令 `$ git status`

### 4. 撤回暂存区内容

- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令
  - `$ git reset HEAD -- 文件名`
  - `$ git reset HEAD -- 文件夹`
  - `$ git reset HEAD -- .` 所有内容

### 5. 形成历史版本

- 把暂存区的内容形成一个历史版本
  - 前提: 暂存区需要有内容
- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令: `$ git commit -m "说明" `
- `$ git commit -a -m ""` 全部加入暂存区然后形成历史版本的简写

### 6. 查看历史版本

- 查看**本地**已经形成的历史版本

- 打开命令行, 切换到 `.git` 所在的目录

- 输入指令 `$ git log`

- 就会以倒叙的形成出现**本地**保存的所有历史版本

- ```shell
    '历史版本 唯一ID'
  commit f984401cf13217326a4d523de330eebd34168d18 (HEAD -> master) '括号内代表这是最新历史版本'
  Author: fxfzxxx <aaron1995228@gmail.com>
    '历史版本的生成时间'
  Date:   Tue Jul 13 12:34:44 2021 +0800
  
      second
  
  commit 7e8b5b449038c1a8d82c8a99f455a3ae48ad06f7
  Author: fxfzxxx <aaron1995228@gmail.com>
  Date:   Tue Jul 13 12:33:39 2021 +0800
  
      first
  
  ```

### 7. 回滚历史版本

- 回到之前某一个历史版本
- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令 `$ git reset --hard 版本id`
- 就可以回到那个时间状态
  - 实际的文件会发生变化
- 注意:
  - 历史回滚之后, 回到过去版本
  - 如果过去版本新增内容, 会走一条新的时间线
  - 如果没上传的情况下
    - 可以在任意时间线和任意时间节点穿梭
  - 如果在上传的情况下
    - 跨时间线穿梭, 需要先回滚到左边共同的时间节点后
    - 再往右边穿梭

<img src="C:\Users\Aaron\AppData\Roaming\Typora\typora-user-images\image-20210713130916707.png" alt="image-20210713130916707" style="zoom:67%;" />

### 8. 删除历史版本

- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令`$ git rebase -i 历史版本id `
  1. 版本id要写删除的前一个id, 会回到前一个id并把后面都删除
  2. 删除的时候, 进入编辑状态后, 需要把 pick 改为 drop, 再次 输入 `:wq` 就可以了

>**删除历史版本的时候会进入编辑状态**
>
>- 按下 i 键, 表示 insert, 插入的意思, 也就是开始编辑文本
>- 把 pick 改为 drop, 再 按 esc
>- 编辑器下面会出现命令等待状态
>- 输入 `:wq` 表示完成编辑, 保存并且退出

- 删除的只是本地记录, 远程上传的不会删除

## git 上传远程

- 上传不是上传 `.git` 所在的文件, 而是上传同级的所有文件

### 1. 建立一个远程仓库

- 就是在 Github 里创建一个''文件夹''
- GitHub 页面右上角加号 --> new repository
- repository 必填, 表示远程仓库名称
- 描述可以写或者不屑
- 点击 create repository 就创建成功了

### 2. 在仓库里保证有一个没有上传的历史版本

### 3. 添加一个远程仓库地址

- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令 `$ git remote add origin 仓库地址`
  - remote 远程
  - add 添加
  - origin 变量名, 可以自己随便书写
  - 仓库地址可以是 gitee 或者是 Github
- 添加完毕后, 在这个 `.git` 所在目录里, 上传到 `origin` 就是上传到这个仓库地址

### 4. 把历史区的内容推送到远程

- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令 `$ git push -u origin master`
  - push 推送
  - -u 记录下本次推送的信息, 到哪一个地址, 哪一个分支
    - 下次如果还是此仓库和此分支, 直接写 `git push ` 就可以了
  - origin 地址变量
  - master 分支

####  4.1 推送时遇到的问题

##### readme.md 问题

- 首先是先在远程仓库创建了 `readme` file, 之后又删除了

- 应该是经历了两次 commit
- 所以即使先 `$git pull origin master`, 再 `$ git push origin master`, 依然是报错
- 解决需要先 `git pull origin master --allow-unrelated-histories`, 之后再 push 就可以了

##### 登录问题1

- 每次 push 都弹出登录框需要登录
- 并且在登录框内输入账号密码, 会登录失败
- 之后提示在ssh内登录时, 输入账号密码, 可以成功登录
- 问题是每次登录都要重新再经历一次以上步骤
- 后来通过在 Github 的 settings 里的 developer settings 里, 设置了 token
- 在下次弹出登录框, 登陆失败后, ssh里登录的时候
- 密码的地方输入 token 就可以了
- 下次就不再弹出登录框了

##### 登录问题2

- 第一次 push 之后弹出登录框需要登陆
- 输入错误密码后, windows 会记录错误密码
- 导致后面的 push, 不会再给机会填写新的密码
- 每次 push 都不成功
- 解决就是要去 控制面板 -> 账户 -> windows凭证 -> github 删掉
- 下次 push 就会重新弹出输入用户名和密码的对话框

### 5. 拉取远程代码

#### 5.1 自己拉取自己的代码

- **第一次拉取**
  - 实际上就是克隆一份到本地
  - 复制 Github 上的一个仓库到本地
  - 打开 github 需要克隆的仓库
    - 复制仓库的远程地址
    - 在本地找到一个需要存放这个文件夹的位置
    - 右键 git bash here
    - 输入指令: `$ git clone 远程仓库地址`
  - 会复制一个一模一样的的文件夹到指定目录
    - 这个文件夹是 git 初始化后的仓库
    - 记录着远程仓库的地址
    - 上传会自动上传到这个地址
    - 可以直接 `git push` 不用加 `-u origin master`
- **第 n 次拉取**
  - 不需要在克隆
  - 只需要在第一次克隆下来的文件夹内
  - 打开命令行, 输入 `$ git pull`
  - 一般实际情况就是 到公司后先 pull 下班前 push
  - 回家后 也先pull 写完后 push
  - 第二天到公司再 pull

#### 5.2 自己拉取别人的代码

-  第一次拉取直接克隆
  - 到想要克隆的位置, 打开命令行, 输入 `$ git clone 地址`
- 第 n 次拉取
  - 直接到 `.git ` 同级目录, 输入 `$ git pull`
- 如果修改了内容想要 push
  - 不会成功, 因为要别人的用户名密码

## 历史回滚冲突问题

- 例子:
  - 1.txt: 第一次编辑 -> `$ git commit m"001"`
  - 1.txt: 第二次编辑 -> `$ git commit m"002"`
  - 历史回滚 ->` git reset --hard 001` 
    - 注意是实际情况 001 替换为随机的版本码
  - 1.txt: 第一次编辑再编辑 -> `$git commit m"001-2"`
  - 上传远程 `$git push -u origin master `
  - 只会得到 001 和 001-2 两个历史版本
  - 第一条时间线上的 002 版本丢失

- 当本地回滚到 001 和 002 两个版本的时候,

- 再次上传就会报错
- 因为远程的版本是 001 和 001-2
- 解决
  - 需要先把远程的 001 和 001-2 pull 下来
  - 然后手动解决冲突, 在 vs code里会有相应提示
  - 假如选择把 002 和 001-2 的更改内容都保留, 相当于两条时间线合并
  - 再次 commit 就会形成下一个历史版本
  - 所以在远程 会有**四个** 历史版本
    - 001
    - 002
    - 001-2
    - 解决冲突后的版本

<img src="C:\Users\Aaron\AppData\Roaming\Typora\typora-user-images\image-20210714124028420.png" alt="image-20210714124028420" style="zoom: 50%;" />

<img src="C:\Users\Aaron\AppData\Roaming\Typora\typora-user-images\image-20210714124532885.png" alt="image-20210714124532885" style="zoom:50%;" />

## 了解 git 相关的三个文件

### 1. git 占位文件

- 当使用 git 管理文件夹的时候
- 空文件夹无法识别
- 一般项目在初始化的时候, 会先准备好目录解构上传一次
  - 就会有空文件夹
- git 提供一个 .gitkeep 文件
  - 没有名称, 只有后缀
- 没有特殊意义
  - 这是为了能够使空文件夹上传

### 2. git 忽略文件

- 在开发的过程中, 会下载很多第三方
- node_modules 文件夹里的文件很多, 最好不上传
- 只需要在初始化项目的时候, 生成 package.json 文件
  - 只需要上传 package.json 文件
- 这时候可以引入 忽略文件 .gitignore
  - 之后后缀, 没有名称
  - 在里面书写不希望上传的文件或者文件夹
  - 文件保存在 .git 的同级目录

### 3. git 说明文件

- readme.md
- 对当前仓库内的描述和说明
- md 语法书写
- 传到远程的时候, 会自动渲染在项目下面

## git 分支

<img src="C:\Users\Aaron\AppData\Roaming\Typora\typora-user-images\image-20210714132642913.png" alt="image-20210714132642913" style="zoom:50%;" />

- 当初始化仓库后, 会自动生成一个分支 master
  - 主要分支或者根分支
- 之后可以创建其它的分支, 分别书写内容
  - 每一个分支的内容相对独立
- 每个独立的功能分支, 最后都合并到 master 上
  - master 就具备了每个功能分支的功能
- 之后哪个功能需要改进, 或者又 bug
  - 就去单独的分支更改

### 1. 创建分支

- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令: `$ git branch 自定义分支名称 `
- **创建的分支, 会复制当前分支的所有内容** 

### 2. 查看分支情况

- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令: `$ git branch`
- 会看到所有分支
- 创建完新的分支后, 如果需要切换到分支, 需要手动切换

### 3. 切换分支

- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令: `$ git checkout 分支名称`
  - ` $ git checkout -b 分支名称` 创建并切换到
- 就会切换到分支 

### 4. 合并分支

- 合并操作: 只能是在哪个分支, 把别的分支合并到自己身上

- 打开命令行, 切换到 `.git` 所在的目录

- 输入指令 `$ git merge 需要合并过来的分支`

- 指定分支就会合并到自己身上

### 5. 删除分支

- 首先要离开要删除的分支
- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令 `$ git branch -d 要删除的分支`
  - 如果分支上又历史版本, 还没有合并
  - 可能会删不掉
- 删不掉的话可以使用强力删除 ( 慎用 )
  - 尽量还是去解决删除不掉的原因
  - 打开命令行, 切换到 `.git` 所在的目录
  - 输入指令 `$ git branch -D 要删除的分支`

### 6. 分支的远程操作

- 当建立其他分支, 默认是不会上传的
  - git 默认上传 master 分支
- 当上传的时候
  - `git push -u origin master`
  - 把当前的分支和远程的 master 建立连接

- `$ git push --set-upstream origin master ` 相当于 `$ git push -u origin master`
  - 意思就是设置好了之后, 以后可以简写 `$ git push `  就上传到 master 分支了
#### 6.1 如果要把自定义的其它分支上传
  - 切换到要上传的分支
  - 打开命令行, 切换到 `.git` 所在的目录
  - 输入指令 `$ git push origin 要上传的分支`

#### 6.2 删除远程分支

- 打开命令行, 切换到 `.git` 所在的目录
- 输入指令: `$ git push origin --delete 要删除的分支`
- 远程分支删除后, 本地分支依然会保留

#### 6.3 特殊分支 `gh-pages`

- 可以把 github 变成一个临时的服务器
  - 在这个分支上 上传一个 index.html 文件
  - 如果不是 index.html, 需要书写文件名
- 上传之后
  - 到 github 并且切换到 gh-pages 分支
  - 点击 settings
  - 下面会有一个 github pages 地址
  - 如果文件是 index.html, 输入地址就能直接访问
  - 如果是 abc.html, 就需要输入地址 + abc.html

### 7 分支的命名规范

- 大家约定俗成的东西
- 有的公司, 会以公司员工的名字命名分支

#### 1. 主分支 - master

- 创建 git 仓库的时候就会产生
- 不接受任何代码上传
- 只接收 dev 分支合并的内容
- 只存储每一个迭代版本中经过测试合格的版本

#### 2. 主开发分支 - dev / development /deve

- 初始化项目之后, 就会从 master 上直接复制开辟的分支
- 不接受任何代码上传
- 只接收 主功能分支 上合并的内容 PR ( Pull Request )
- 存储开发过程中, 每一个阶段的内容

#### 3. 主功能分支 - feature-xxx

- 直接从 dev 分支上开辟出来的分支
- 进行不同功能的开发
- 开发完毕后把代码合并到 dev 分支上
- 接收文件上传

#### 4. 功能 bug 解决分支 - feature-xxx-fix-xxx

- 在项目运行的过程中, 出现 bug 进行修复的分支
- 都是从 功能分支 上开辟出来的
- 修改完毕后, 合并到主分支上
- 再由功能分支合并到 dev 分支上
- 一般不删除, 开多少留多少, 后期打架的资本, 证明干活了

#### 5. 紧急 bug 解决分支 - hot-fix-xxx

- 直接从 master 上开辟
- 进行 bug 的紧急修复
- 修复完 可以直接合并到 master 上
- 微博服务器炸了
- 能开这个分支的人解决了, 有额外的奖金

## git 密钥

- GitHub 上除了可以使用 https 的地址
  - 还可以使用 ssh 地址
  - 需要在电脑里也配置一个密钥
  - 完事可以直接登录 github

1. 打开命令行, 目录无所谓

2. 输入指令: `$ ssh-keygen -t rsa -C "github配置的全局邮箱"`

   - 可以输入 `$ git config --list ` 查看全局邮箱

   - 回车后, 要求输入二次密码
   - 可以不写, 直接三个回车
   - 生成花里胡哨的密钥

3. 去到电脑里找到密钥

   1. 目录下的 pub 文件
   2. 复制里面的所有内容

4. 来到 github settings

   1. 选择 ssh, 并创建新的 ssh key
   2. title 随便写
   3. key 的位置粘贴刚才复制的密钥

5. 添加成功

   - 以后就可以使用 ssh 地址上传和下载了



